import duckdb
import json

con = duckdb.connect()
filename = 'ol_dump_editions_2025-12-31.txt.gz' # –ü—Ä–æ–≤–µ—Ä—å –∏–º—è!

# –ö–ª—é—á –º–æ–Ω—Å—Ç—Ä–∞ –∏–∑ —Ç–≤–æ–µ–≥–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
monster_key = '/books/OL59216279M'

print(f"üî¨ –í—Å–∫—Ä—ã–≤–∞–µ–º –ø–∞—Ü–∏–µ–Ω—Ç–∞ {monster_key}...")

# –î–æ—Å—Ç–∞–µ–º —Å—ã—Ä–æ–π JSON –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–π –∫–Ω–∏–≥–∏
query = f"""
SELECT column4
FROM read_csv(
    '{filename}', 
    header=False, 
    delim='\\t', 
    quote='', 
    escape='', 
    all_varchar=True, 
    max_line_size=20000000 -- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –∏–Ω–∞—á–µ –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç!
) 
WHERE column1 = '{monster_key}'
"""

raw_json = con.execute(query).fetchone()

if raw_json:
    data = json.loads(raw_json[0])
    
    print("\n--- –ê–ù–ê–õ–ò–ó –ü–û–õ–ï–ô ---")
    # –ü—Ä–æ–±–µ–≥–∞–µ–º—Å—è –ø–æ –≤—Å–µ–º –ø–æ–ª—è–º –∏ –∏—â–µ–º –∂–∏—Ä–Ω–æ–µ
    for key, value in data.items():
        # –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É, —á—Ç–æ–±—ã –∏–∑–º–µ—Ä–∏—Ç—å –¥–ª–∏–Ω—É
        str_val = str(value)
        size_mb = len(str_val) / 1024 / 1024
        
        print(f"–ü–æ–ª–µ '{key}': {size_mb:.4f} MB")
        
        if size_mb > 1:
            print(f"‚ö†Ô∏è  –ù–ê–®–ï–õ! –í–∏–Ω–æ–≤–Ω–∏–∫ —Ç–æ—Ä–∂–µ—Å—Ç–≤–∞: –ø–æ–ª–µ '{key}'")
            print("–í–æ—Ç –Ω–∞—á–∞–ª–æ —ç—Ç–æ–≥–æ –ø–æ–ª—è (–ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤):")
            print(str_val[:100] + "...")
            
            if "data:image" in str_val[:50]:
                print("üí° –î–ò–ê–ì–ù–û–ó: –≠—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64! –ö—Ç–æ-—Ç–æ –≤—Å—Ç–∞–≤–∏–ª —Ñ–∞–π–ª –≤–º–µ—Å—Ç–æ —Å—Å—ã–ª–∫–∏.")
            else:
                print("üí° –î–ò–ê–ì–ù–û–ó: –ü–æ—Ö–æ–∂–µ –Ω–∞ –∫—É—á—É —Ç–µ–∫—Å—Ç–∞.")
else:
    print("‚ùå –ù–µ –Ω–∞—à–µ–ª –∫–Ω–∏–≥—É. –ü—Ä–æ–≤–µ—Ä—å monster_key –∏–ª–∏ –∏–º—è —Ñ–∞–π–ª–∞.")